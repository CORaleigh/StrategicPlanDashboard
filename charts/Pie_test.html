<html>
<head>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vega/2.6.1/vega.min.js"></script>
  <script type="text/javascript" src="https://npmcdn.com/arcgis-cedar/dist/cedar.js"></script>
</head>
<body>

<div class="row">
<h3 align="center"; style="font-family:Helvetica">Permits</h3>
  <div style="width: 500px; height: 400px" id="chart"></div>

</div>

<script>
  var chart = new Cedar({"type":"pie"});

  var datasets = [
    {
      "url":"http://maps.wakegov.com/arcgis/rest/services/Inspections/Permits/MapServer/0",
      "query": {
        "orderByFields": "STATUSCURRENT_count DESC",
        // because we're using an expression here
        // this will be named EXPR_1 in the JSON response's attributes
        "groupByFieldsForStatistics": groupByExpression,
        "outStatistics": [{
          "statisticType": "count",
          // when counting records (not summing values)
          // it's best to use the id field because
          // it is guaranteed to have a value for every record
          "onStatisticField": "STATUSCURRENT",
          "outStatisticFieldName": "STATUSCURRENT_count"
        }]
      }
    }
  ];
  var series = [
    {
      "category": {"field":"EXPR_1","label":"Current Status"},
      "value": { "field":"STATUSCURRENT_count","label":"Number of Permits Status" },
      "radius": 270
    }
  ];
  chart.datasets = datasets;
  chart.series = series;


  chart.tooltip = {
    // this is the month abbreviation returned from the expresssion above
    "title": "{EXPR_1}",
    "content": "{STATUSCURRENT_count} Permits"
  }
  chart.show({
    elementId: "#chart",
    width: 600,
    height: 600,
    autolabels: false
  });
</script>
</body>
</html>
